generator client {
    provider = "prisma-client-js"
    output   = "../generated/prisma"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

//TODO: add indexes accordingly to most common queries

model Session {
    id        Int        @id @default(autoincrement())
    visitorId String // random UUID stored in cookie
    ip        String
    userAgent String
    browser   String?
    os        String?
    referrer  String?
    startTime DateTime   @default(now())
    endTime   DateTime // updated as long as the user is active
    PageView  PageView[]

    @@index([endTime, startTime])
    @@index([visitorId, endTime, startTime])
    @@index([os, endTime, startTime])
    @@index([browser, endTime, startTime])
    @@index([referrer, endTime, startTime])
}

model PageView {
    id        Int      @id @default(autoincrement())
    sessionId Int
    session   Session  @relation(fields: [sessionId], references: [id])
    pageUrl   String
    timestamp DateTime @default(now())

    @@index([timestamp])
    @@index([pageUrl])
    @@index([sessionId])
    @@index([pageUrl, timestamp])
}
